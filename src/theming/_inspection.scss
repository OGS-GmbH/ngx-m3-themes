@use "sass:map";
@use "@angular/material" as mat;
@use "./internals" as internals;

/// Resolves a color token from the theme's internal token map.
/// @group Inspection
/// @name _resolve-token
/// @access private
/// @parameter {Map} $theme - The Material 3 theme object
/// @parameter {String} $token - The token name to resolve
/// @return {Color} The resolved color value
/// @throw Error if the token is not defined in the theme
/// @author Simon Kovtyk
@function _resolve-token($theme, $token) {
  $is-internal-token: internals.is-internal-token($token);

  @if $is-internal-token {
    @return mat.get-theme-color($theme, $token);
  }

  $internal-root: map.get($theme, internals.$theming);
  $internal-color-tokens: map.get($internal-root, color-tokens);
  $internal-tokens-root: map.get($internal-color-tokens, internals.$tokens-root);

  $is-valid-token: map.has-key($internal-tokens-root, $token);

  @if not $is-valid-token {
    @error "Token \"" + $token + "\" is not defined.";
  }

  @return map.get($internal-tokens-root, $token);
}

/// Resolves a color from a palette at a specific hue.
/// @group Inspection
/// @name _resolve-palette
/// @access private
/// @parameter {Map} $theme - The Material 3 theme object
/// @parameter {String} $palette - The palette name (e.g., 'primary', 'secondary')
/// @parameter {Number} $hue - The hue value from the palette (e.g., 50, 100, 500)
/// @return {Color} The resolved color value
/// @throw Error if the palette doesn't exist
/// @throw Error if the hue is not defined in the palette
/// @author Simon Kovtyk
@function _resolve-palette($theme, $palette, $hue) {
  $is-internal-palette: internals.is-internal-palette($palette);

  @if $is-internal-palette {
    @return mat.get-theme-color($theme, $palette, $hue);
  }

  $internal-root: map.get($theme, internals.$theming);
  $internal-palettes: map.get($internal-root, palettes);

  $is-valid-palette: map.has-key($internal-palettes, $palette);

  @if not $is-valid-palette {
    @error "Palette \"" + $palette + "\" does not exists.";
  }

  $internal-palette: map.get($internal-palettes, $palette);

  $is-valid-hue: map.has-key($internal-palette, $hue);

  @if not $is-valid-hue {
    @error "Hue \"" + $hue + "\" from palette \"" + $palette + "\" is not defined.";
  }

  @return map.get($internal-palette, $hue);
}

/// Retrieves a color from a Material 3 theme by token name or palette/hue combination.
/// This function provides a unified interface for accessing theme colors, supporting both:
/// - Direct token access (1 argument)
/// - Palette + hue access (2 arguments)
/// @group Inspection
/// @name get-theme-color
/// @access public
/// @parameter {Map} $theme - The Material 3 theme object to query
/// @parameter {ArgList} $args - Variable arguments for color resolution
///   - When 1 argument: `$token` - The token name (e.g., 'primary', 'on-surface')
///   - When 2 arguments: `$palette, $hue` - The palette name and hue value
/// @return {Color} The resolved color value from the theme
/// @throw Error if theme version is not M3 (version 1)
/// @throw Error if more than 2 arguments are provided
/// @throw Error if the specified token or palette/hue combination doesn't exist
/// @author Simon Kovtyk
@function get-theme-color($theme, $args...) {
  $theme-version: mat.get-theme-version($theme);

  @if $theme-version != 1 {
    @error "Only M3 themes are currently supported."
  }

  $args-length: length($args);

  @if $args-length == 1 {
    @return _resolve-token($theme, nth($args, 1));
  } @else if $args-length == 2 {
    @return _resolve-palette($theme, $args...);
  } @else {
    @error "Argument length is not supposed to be more then two arguments long.";
  }
}